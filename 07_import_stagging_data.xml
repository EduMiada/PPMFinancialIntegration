
<NikuDataBus xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../xsd/nikuxog_contentPack.xsd"><Header action="write" externalSource="NIKU" objectType="contentPack" version="13.3.0.286"/><contentPack update="true"><Processes><Process allowOneRunningInstance="false" code="cabr_load_transactions" createdBy="admprj" endStep="Término" source="customer"
    startOption="ON_DEMAND" startStep="Início"><nls languageCode="cs" name="01 - Carrega Transações"/><nls languageCode="da" name="01 - Carrega Transações"/><nls languageCode="de" name="01 - Carrega Transações"/><nls languageCode="en" name="01 - Carrega Transações"/><nls languageCode="es" name="01 - Carrega Transações"/><nls languageCode="fi" name="01 - Carrega Transações"/><nls languageCode="fr" name="01 - Carrega Transações"/><nls languageCode="hu" name="01 - Carrega Transações"/><nls languageCode="it" name="01 - Carrega Transações"/><nls languageCode="ja" name="01 - Carrega Transações"/><nls languageCode="ko" name="01 - Carrega Transações"/><nls languageCode="nl" name="01 - Carrega Transações"/><nls languageCode="no" name="01 - Carrega Transações"/><nls languageCode="pl" name="01 - Carrega Transações"/><nls description="Carrega transações do arquivo texto na tabela stagging." languageCode="pt" name="01 - Carrega Transações"/><nls languageCode="ru" name="01 - Carrega Transações"/><nls languageCode="sv" name="01 - Carrega Transações"/><nls languageCode="tr" name="01 - Carrega Transações"/><nls languageCode="zh" name="01 - Carrega Transações"/><nls languageCode="zh_TW" name="01 - Carrega Transações"/><Security><GroupSecurity groupCode="rnv_eng_financeiro" rightCode="PROCESS-DEF-INST-READ"/><GroupSecurity groupCode="rnv_eng_financeiro" rightCode="PROCESS-DEF-INST-START"/><GroupSecurity groupCode="rnv_eng_financeiro" rightCode="PROCESS-RUN-INST-CANCEL"/><GroupSecurity groupCode="rnv_eng_financeiro" rightCode="PROCESS-RUN-INST-DELETE"/><UserSecurity rightCode="PROCESS-DEF-INST-INITIATE" userName="admprj"/><UserSecurity rightCode="PROCESS-DEF-INST-WRITE" userName="admprj"/><UserSecurity rightCode="PROCESS-DEF-INST-START" userName="xog_user"/></Security><Objects><Object manualStart="true" name="cabrFin" objectType="cabr_int_financials" partitionCode="NIKU.ROOT" partitionModeCode="PARTITION_ONLY" type="BPM_POT_PRIMARY"/></Objects><Steps><Step id="Início" isMileStone="false" sequenceNo="1"><nls languageCode="cs" name="Início"/><nls languageCode="da" name="Início"/><nls languageCode="de" name="Início"/><nls languageCode="en" name="Início"/><nls languageCode="es" name="Início"/><nls languageCode="fi" name="Início"/><nls languageCode="fr" name="Início"/><nls languageCode="hu" name="Início"/><nls languageCode="it" name="Início"/><nls languageCode="ja" name="Início"/><nls languageCode="ko" name="Início"/><nls languageCode="nl" name="Início"/><nls languageCode="no" name="Início"/><nls languageCode="pl" name="Início"/><nls languageCode="pt" name="Início"/><nls languageCode="ru" name="Início"/><nls languageCode="sv" name="Início"/><nls languageCode="tr" name="Início"/><nls languageCode="zh" name="Início"/><nls languageCode="zh_TW" name="Início"/><Notifications notifyOwner="false"><NotifyWhen stepCompleted="false" stepInError="false" stepStarted="false"/><Assignees/></Notifications><Operations/><TransitionRestrictions><TransitionRestriction><Join type="BPM_JT_NONE"><Condition sequencNo="1" type="BPM_SCT_PRECONDITION"/></Join></TransitionRestriction><TransitionRestriction><Split type="BPM_ST_SEQUENCE"><Condition sequencNo="1" type="BPM_SCT_POSTCONDITION"><Transitions><Transition to="cabr_carregar_arquivo"/></Transitions></Condition></Split></TransitionRestriction></TransitionRestrictions></Step><Step id="Término" isMileStone="false" sequenceNo="2"><nls languageCode="cs" name="Término"/><nls languageCode="da" name="Término"/><nls languageCode="de" name="Término"/><nls languageCode="en" name="Término"/><nls languageCode="es" name="Término"/><nls languageCode="fi" name="Término"/><nls languageCode="fr" name="Término"/><nls languageCode="hu" name="Término"/><nls languageCode="it" name="Término"/><nls languageCode="ja" name="Término"/><nls languageCode="ko" name="Término"/><nls languageCode="nl" name="Término"/><nls languageCode="no" name="Término"/><nls languageCode="pl" name="Término"/><nls languageCode="pt" name="Término"/><nls languageCode="ru" name="Término"/><nls languageCode="sv" name="Término"/><nls languageCode="tr" name="Término"/><nls languageCode="zh" name="Término"/><nls languageCode="zh_TW" name="Término"/><Notifications notifyOwner="false"><NotifyWhen stepCompleted="false" stepInError="false" stepStarted="false"/><Assignees/></Notifications><Operations/><TransitionRestrictions><TransitionRestriction><Join type="BPM_JT_NONE"><Condition sequencNo="1" type="BPM_SCT_PRECONDITION"/></Join></TransitionRestriction><TransitionRestriction><Split type="BPM_ST_SEQUENCE"><Condition sequencNo="1" type="BPM_SCT_POSTCONDITION"><Transitions/></Condition></Split></TransitionRestriction></TransitionRestrictions></Step><Step id="cabr_carregar_arquivo" isMileStone="false" sequenceNo="3"><nls languageCode="cs" name="Carregar Arquivo"/><nls languageCode="da" name="Carregar Arquivo"/><nls languageCode="de" name="Carregar Arquivo"/><nls languageCode="en" name="Carregar Arquivo"/><nls languageCode="es" name="Carregar Arquivo"/><nls languageCode="fi" name="Carregar Arquivo"/><nls languageCode="fr" name="Carregar Arquivo"/><nls languageCode="hu" name="Carregar Arquivo"/><nls languageCode="it" name="Carregar Arquivo"/><nls languageCode="ja" name="Carregar Arquivo"/><nls languageCode="ko" name="Carregar Arquivo"/><nls languageCode="nl" name="Carregar Arquivo"/><nls languageCode="no" name="Carregar Arquivo"/><nls languageCode="pl" name="Carregar Arquivo"/><nls languageCode="pt" name="Carregar Arquivo"/><nls languageCode="ru" name="Carregar Arquivo"/><nls languageCode="sv" name="Carregar Arquivo"/><nls languageCode="tr" name="Carregar Arquivo"/><nls languageCode="zh" name="Carregar Arquivo"/><nls languageCode="zh_TW" name="Carregar Arquivo"/><Notifications notifyOwner="false"><NotifyWhen stepCompleted="false" stepInError="false" stepStarted="false"/><Assignees/></Notifications><Operations><Action code="import" synchronized="true" type="BPM_SAT_CUSTOM"><nls languageCode="cs" name="import"/><nls languageCode="da" name="import"/><nls languageCode="de" name="import"/><nls languageCode="en" name="import"/><nls languageCode="es" name="import"/><nls languageCode="fi" name="import"/><nls languageCode="fr" name="import"/><nls languageCode="hu" name="import"/><nls languageCode="it" name="import"/><nls languageCode="ja" name="import"/><nls languageCode="ko" name="import"/><nls languageCode="nl" name="import"/><nls languageCode="no" name="import"/><nls languageCode="pl" name="import"/><nls languageCode="pt" name="import"/><nls languageCode="ru" name="import"/><nls languageCode="sv" name="import"/><nls languageCode="tr" name="import"/><nls languageCode="zh" name="import"/><nls languageCode="zh_TW" name="import"/><customScript languageCode="gel"><scriptText><gel:script xmlns:core="jelly:core" xmlns:file="jelly:com.niku.union.gel.FileTagLibrary"
                  xmlns:gel="jelly:com.niku.union.gel.GELTagLibrary" xmlns:soap="jelly:com.niku.union.gel.SOAPTagLibrary"
                  xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:sql="jelly:sql" xmlns:util="jelly:util"
                  xmlns:xog="http://www.niku.com/xog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><!--PARAMETERS--><gel:parameter default="admprj" var="XOG_USER_NAME"/><gel:parameter default="clarity" secure="true" var="XOG_PASSWORD"/><gel:parameter default="/fs0/clarity1/share/includes/" var="INCLUDE_FOLDER"/><gel:parameter default="/fs0/clarity1/share/entrada/" var="ORIGIN_FOLDER"/><gel:parameter default="/fs0/clarity1/share/entrada/processado/" var="TARGET_FOLDER"/><gel:parameter default="1" var="DebugLevel"/><!--PARAMETERS--><!--VARIAVEIS UTILIZADAS INCLUDES XOG--><core:set value="" var="XOG_SERVER_URL"/><core:set value="" var="XOG_SESSION_ID"/><core:set value="" var="XOG_STATUS_STATE"/><core:set value="" var="XOG_FAILURE_RECORDS"/><core:set value="" var="XOG_INSERTED_RECORDS"/><core:set value="" var="XOG_UPDATED_RECORDS"/><core:set value="" var="XOG_TOTAL_RECORDS"/><core:set value="" var="XOG_REF_NUMBER"/><core:set value="" var="XOG_ERR_INFORMATION"/><core:set value="" var="XOG_SERIALIZED_FILE"/><core:set value="" var="XOG_SERIALIZED_OUTPUT_FILE"/><core:set value="" var="XOG_EXCEPTION"/><!--FIM VARIAVEIS UTILIZADAS INCLUDES XOG--><!--PREENCHE URL DO SERVIDOR --><core:include file="${INCLUDE_FOLDER}gel_include_get_server_url.xml"/><core:if test="${XOG_SERVER_URL == null}"><gel:log level="ERROR" message="Nao foi possivel identificar URL Servidor XOG: ${XOG_EXCEPTION}"/></core:if><gel:log level="debug" message="Variavel depois include: ${XOG_SERVER_URL}"/><!--FIM PREENCHE URL DO SERVIDOR --><!--SUPPORT VARIABLES --><core:set value="0" var="FILE_EXISTS"/><core:set value="0" var="FILE_HAS_CONTENT"/><core:set value=" " var="ORIGIN_FILE_NAME"/><core:set value="0" var="STAGGING_DATA_RECORDS"/><core:set value="0" var="icount"/><!--END SUPPORT VARIABLES --><!--XOG HEADER TO FULL DOC--><gel:parse var="xmldoc"><NikuDataBus xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../xsd/nikuxog_customObjectInstance.xsd"><Header action="write" externalSource="NIKU" objectType="customObjectInstance" version="13.0.1.0102"/><customObjectInstances objectCode="cabr_int_fin_staging"/></NikuDataBus></gel:parse><!--END XOG HEADER TO FULL DOC--><!--CONNECT TO THE DB--><gel:setDataSource dbId="niku"/><!--INICIO: Preenche valores default das transacoes cadastrado no objeto--><sql:query escapeText="false" var="sqlResult"><![CDATA[
				SELECT 	code, def_transaction_type, def_charge_code, def_currency, cabr_import_file, rnv_mail_error
				FROM odf_ca_cabr_int_financials WHERE id = ${gel_objectInstanceId}
				]]></sql:query><core:forEach items="${sqlResult.rows}" trim="true" var="rowD"><core:set value="${rowD.code}" var="parentInstanceCode"/><core:set value="${rowD.def_transaction_type}" var="transactiontype"/><core:set value="${rowD.def_charge_code}" var="chargecode"/><core:set value="${rowD.def_currency}" var="actualcostratecur"/><core:set value="${rowD.cabr_import_file}" var="ORIGIN_FILE_NAME"/><core:set value="${rowD.rnv_mail_error}" var="MAIL_TO_ADMIN"/></core:forEach><!--FIM: Preenche valores default das transacoes cadastrado no objeto--><core:if test="${DebugLevel > 0}"><gel:log level="debug" message="LOG001a: ORIGIN_FOLDER = ${ORIGIN_FOLDER}"/><gel:log level="debug" message="LOG001b: TARGET_FOLDER = ${TARGET_FOLDER}"/><gel:log level="debug" message="LOG001c: ORIGIN_FILE_NAME = ${ORIGIN_FILE_NAME}"/><gel:log level="debug" message="LOG001d: gel_processInstanceId = ${gel_processInstanceId}"/><gel:log level="debug" message="LOG001e: Server URL = ${XOG_SERVER_URL}"/><gel:log level="debug" message="LOG001e: MAIL ADMIN = ${MAIL_TO_ADMIN}"/></core:if><!--PREENCHE VARIAVEIS DE ARQUVISO XOG--><core:set value="${TARGET_FOLDER}${ORIGIN_FILE_NAME}_PID_${gel_processInstanceId}.XML" var="XOG_SERIALIZED_FILE"/><core:set value="${TARGET_FOLDER}${ORIGIN_FILE_NAME}_PID_${gel_processInstanceId}_OUTPUT.XML" var="XOG_SERIALIZED_OUTPUT_FILE"/><!--CHECK IF THE FILE EXISTS ON THE FTP FOLDER, IF NOT LOG AND EXIT --><core:if test="${DebugLevel > 0}"><gel:log level="debug" message="VERIFICA SE ARQUIVO EXISTE"/></core:if><util:available file="${ORIGIN_FOLDER}${ORIGIN_FILE_NAME}"><core:set value="1" var="FILE_EXISTS"/></util:available><core:if test="${DebugLevel > 0}"><gel:log level="debug" message="ARQUIVO EXISTE: ${FILE_EXISTS}"/></core:if><!--END CHECK IF THE FILE EXISTS --><!--IF FILE EXISTS START PROCESSING--><core:if test="${FILE_EXISTS == 1}"><core:if test="${DebugLevel > 0}"><gel:log level="debug" message="INICIA PROCESSAMENTO DO ARQUIVO"/></core:if><!--READ INPUT FILE--><file:readFile delimiter=";" embedded="false" fileName="${ORIGIN_FOLDER}${ORIGIN_FILE_NAME}" var="inputFile"/><core:if test="${DebugLevel > 0}"><gel:log level="debug" message="ARQUIVO CARREGADO COM SUCESSO"/><gel:log level="debug" message="LINHAS DISPONIVEIS:  ${inputFile.size()} "/></core:if><!--CHECK RETURNED ROWS IF NONE EXIT --><core:if test="${inputFile.size() == 0}"><core:if test="${DebugLevel > 0}"><gel:log level="debug" message="NENHUM LINHA RETORNADA TERMINA PROCESSAMENTO"/></core:if></core:if><!--HAS ROWS START LOOP--><core:if test="${inputFile.size() > 0}"><!--FAZ COPIA DO ARQUIVO RECEBIDO--><core:new className="java.io.File" var="originFile"><core:arg type="java.lang.String" value="${ORIGIN_FOLDER}${ORIGIN_FILE_NAME}"/></core:new><core:new className="java.io.File" var="targetFile"><core:arg type="java.lang.String" value="${TARGET_FOLDER}${ORIGIN_FILE_NAME}_${gel_processInstanceId}"/></core:new><core:set value="${originFile.renameTo( targetFile )}" var="renamed"/><core:if test="${DebugLevel > 0}"><gel:log level="debug" message="ARQUIVO RENOMEADO: ${renamed}"/></core:if><!--FIM FAZ COPIA DO ARQUIVO RECEBIDO--><!--INICIO: verifica se existem registros carregados que ainda nao foram importado, se existir notifica usiario e sai--><sql:query escapeText="false" var="sqlResult"><![CDATA[
				SELECT 	NVL(count(*),0) contador from odf_ca_cabr_int_fin_staging WHERE odf_parent_id = ${gel_objectInstanceId}
							]]></sql:query><core:forEach items="${sqlResult.rows}" trim="true" var="row"><core:set value="${row.contador}" var="STAGGING_DATA_RECORDS"/></core:forEach><core:if test="${DebugLevel > 0}"><gel:log level="debug" message="LINHAS EXISTENTES STAGGING_DATA: ${STAGGING_DATA_RECORDS}"/></core:if><!--NOTIFICA USUARIO ARQUIVO NAO FOI CARREGADO--><core:if test="${STAGGING_DATA_RECORDS != 0}"><core:if test="${DebugLevel > 0}"><gel:log level="debug" message="EXISTEM LINHAS NAO PROCESSADAS NA TABELA STAGGING_DATA SAINDO DA ROTINA"/></core:if><gel:email from="admin-clarity@clarity.com" fromName="Clarity Admin"
                          subject="[CLARITY - PROTHEUS - IMPORTAÇÃO] - PASSO 01: ERRO NA IMPORTAÇÃO ARQUIVO PROTHEUS : ${gel_objectInstanceId}" to="${MAIL_TO_ADMIN}"><![CDATA[
							Não foi possível importar o arquivo ${ORIGIN_FILE_NAME}.
							Existe(m) registro(s) na tabela "Registros Importados" que devem ser validados e processados antes da importação de novos arquivos.</br></br>
							Instância Integração: ${gel_objectInstanceId}</br>
							Instância Processo: ${gel_processInstanceId} </br>
							]]></gel:email></core:if><!--INICIO: VERIFICA LINHAS EXISTENTES STAGGING--><core:if test="${STAGGING_DATA_RECORDS == 0}"><core:forEach items="${inputFile.getRows()}" var="row"><!--overrideAutoNumbering="false" not working in v13 workaround to get a code number--><core:set value="${icount+1}" var="icount"/><!--SET LOCAL VARIABLES --><core:set value="${row[0]}" var="projetoParque"/><core:set value="${row[1]}" var="projectcode"/><core:set value="${row[2]}" var="taskID"/><core:set value="${row[3]}" var="vendorCode"/><core:set value="${row[4]}" var="poNumber"/><core:set value="${row[5]}" var="transactiondate"/><core:set value="${row[6]}" var="units"/><core:set value="${row[7]}" var="actualcostrate"/><core:set value="${row[8]}" var="faturamento_direto"/><core:set value="${row[9]}" var="adiantamento"/><!--Se for nota de faturamento direto passa o codigo para o campo user value 1--><core:set value="" var="userlov1"/><core:if test="${faturamento_direto == 1}"><core:set value="FATURA_DIRETO" var="userlov1"/></core:if><!--Se for adiantamento o codigo para o campo user value 2--><core:set value="" var="userlov2"/><core:if test="${adiantamento == 'PA'}"><core:set value="ADIANTAMENTO" var="userlov2"/></core:if><!--INICIO: Preenche informacoes do usuario da transacao cadastrado no objeto parametro de configuracao do parque--><sql:query escapeText="false" var="sqlResult"><![CDATA[
												SELECT 	res.unique_name resourcecode, 
														rol.unique_name rolecode,
														tpcode.prexternalID inputtypecode, 
														pacr.transclass transactionclass
											
												  FROM SRM_RESOURCES res 
													  INNER JOIN PRJ_RESOURCES prj_res on res.id = prj_res.prid
													  INNER JOIN PAC_MNT_RESOURCES pacr on res.id = pacr.id
													  INNER JOIN PRTYPECODE tpcode on prj_res.prtypecodeID = tpcode.prid
													  INNER JOIN odf_ca_rnv_param_integracao paramInt	on res.unique_name = paramInt.rnv_recurso_trans
													  --INNER JOIN  prassignment on res.id = a.PRRESOURCEID 
													  INNER JOIN srm_projects p on paramInt.odf_parent_id = p.id
													  LEFT JOIN SRM_RESOURCES rol on prj_res.prPrimaryRoleID = rol.id
													  
												  WHERE 
													  p.unique_name= '${projetoParque}'
													  AND paramInt.rnv_projeto_code = '${projectcode}' 
													  --a.prtaskid = NVL(${taskID},0)
													  AND res.RESOURCE_TYPE = 3 --expense
													  --AND paramInt.is_active = 1
											]]></sql:query><core:forEach items="${sqlResult.rows}" trim="true" var="rowRes"><core:set value="${rowRes.resourcecode}" var="resourcecode"/><core:set value="${rowRes.rolecode}" var="rolecode"/><core:set value="${rowRes.inputtypecode}" var="inputtypecode"/><core:set value="${rowRes.transactionclass}" var="transactionclass"/></core:forEach><!--FIM: Preenche informacoes do usuario da transacao cadastrado no objeto parametro de configuracao do parque--><!--PARSE RECORD ON XMLDOC--><gel:parse var="xmldoc_instance"><instance instanceCode="${gel_processInstanceId}-${icount}" objectCode="cabr_int_fin_staging"
                              parentInstanceCode="${parentInstanceCode}" parentObjectCode="cabr_int_financials"><CustomInformation><ColumnValue name="odf_parent_id">${gel_objectInstanceId}</ColumnValue><ColumnValue name="odf_cncrt_parent_id">${gel_objectInstanceId}</ColumnValue><ColumnValue name="partition_code">NIKU.ROOT</ColumnValue><ColumnValue name="vouchernumber">${gel_processInstanceId}${icount}</ColumnValue><ColumnValue name="groupid">${gel_processInstanceId}${icount}</ColumnValue><ColumnValue name="acao">I</ColumnValue><ColumnValue name="validated">false</ColumnValue><ColumnValue name="chargeable">0</ColumnValue><ColumnValue name="validation_msg">.</ColumnValue><ColumnValue name="code">${gel_processInstanceId}-${icount}</ColumnValue><ColumnValue name="name">${gel_processInstanceId} - ${poNumber}</ColumnValue><ColumnValue name="vendorCode">${vendorCode}</ColumnValue><ColumnValue name="poNumber">${poNumber}</ColumnValue><ColumnValue name="transactiontype">${transactiontype}</ColumnValue><ColumnValue name="externalid">${gel_processInstanceId}${icount}</ColumnValue><ColumnValue name="projectcode">${projectcode}</ColumnValue><ColumnValue name="taskID">${taskID}</ColumnValue><ColumnValue name="resourcecode">${resourcecode}</ColumnValue><ColumnValue name="rolecode">${rolecode}</ColumnValue><ColumnValue name="chargecode">${chargecode}</ColumnValue><ColumnValue name="inputtypecode">${inputtypecode}</ColumnValue><ColumnValue name="transactionclass">${transactionclass}</ColumnValue><ColumnValue name="userlov1">${userlov1}</ColumnValue><ColumnValue name="userlov2">${userlov2}</ColumnValue><ColumnValue name="transactiondate">${transactiondate}T00:00:00</ColumnValue><ColumnValue name="units">${units}</ColumnValue><ColumnValue name="actualcostrate">${actualcostrate}</ColumnValue><ColumnValue name="actualcostratecur">${actualcostratecur}</ColumnValue><ColumnValue name="billrate">${actualcostrate}</ColumnValue><ColumnValue name="billratecur">${actualcostratecur}</ColumnValue></CustomInformation><OBSAssocs complete="false"/><Security><UserSecurity rightCode="odf_cst_cabr_int_fin_staging_edit" userName="admprj"/></Security></instance></gel:parse><!--ADD the project on main file --><gel:set insert="true" select="$xmldoc/NikuDataBus/customObjectInstances" value="${xmldoc_instance}"/></core:forEach><!--FAZ LOGON E RETORNA SESSIONID--><core:include file="${INCLUDE_FOLDER}gel_include_logon_server.xml"/><core:if test="${XOG_SESSION_ID == null}"><gel:log level="ERROR" message="Nao foi possivel realizar logon Clarity: ${XOG_EXCEPTION}"/></core:if><gel:log level="debug" message="Variavel depois include session id: ${XOG_SESSION_ID}"/><!--FIM LOGON E RETORNA SESSIONID--><core:if test="${XOG_SESSION_ID != null}"><!--FAZ CHAMADA XOG--><core:include file="${INCLUDE_FOLDER}gel_include_invoke_ws.xml"/><!--core:if test="${XOG_EXCEPTION != null}"><gel:log level="ERROR" message="Nao foi realizar XOG: ${XOG_EXCEPTION}"/><gel:email 	from="admin-clarity@clarity.com" 
								fromName="Clarity Admin" 
								subject="[CLARITY - PROTHEUS - IMPORTAÇÃO] - PASSO 01: ERRO NA IMPORTAÇÃO ARQUIVO PROTHEUS : ${gel_objectInstanceId}" 
								to="${MAIL_TO_ADMIN}"><![CDATA[
				
								O arquivo não pode ser importado ${ORIGIN_FILE_NAME}.</br>
								Verifique erros no arquivo de saída XOG, corrija os erros e erros e re-importe o arquivo.</br>
								Caso os arquivos não tenham sido gerados re-execute o processo com o parâmetro Debug = 2.</br></br></br>
								Instância Integração: ${gel_objectInstanceId}</br>
								Instância Processo: ${gel_processInstanceId} </br></br>
								Arquivo XOG: ${XOG_SERIALIZED_FILE}</br>
								Arquivo Saída XOG: ${XOG_SERIALIZED_OUTPUT_FILE}</br>
								]]></gel:email></core:if--><gel:log level="debug" message="XOG_STATUS_STATE : ${XOG_STATUS_STATE}"/><gel:log level="debug" message="XOG_FAILURE_RECORDS : ${XOG_FAILURE_RECORDS}"/><gel:log level="debug" message="XOG_INSERTED_RECORDS: ${XOG_INSERTED_RECORDS}"/><gel:log level="debug" message="XOG_UPDATED_RECORDS : ${XOG_UPDATED_RECORDS}"/><gel:log level="debug" message="XOG_TOTAL_RECORDS : ${XOG_TOTAL_RECORDS}"/><gel:log level="debug" message="XOG_REF_NUMBER  : ${XOG_REF_NUMBER}"/><gel:log level="debug" message="XOG_ERR_INFORMATION : ${XOG_ERR_INFORMATION}"/><!--FIM LOGON E RETORNA SESSIONID--></core:if><!--FIM DO  PROCESSAMENTO DA ROTINA--></core:if><!--FIM: VERIFICA LINHAS EXISTENTES STAGGING--><!--INICIO: VERIFICACAO DE QUANTIDADE DE REGISTROS--><!--SE A QUANTIDADE DE REGISTROS INSERIDOS FOR DIFERENTE DA QUANTIDADE DISPONIVEL 
			NO ARQUIVO APAGA TODOS OS REGISTROS E MANDA EMAIL PARA ADMIN DE ERRO--><sql:query escapeText="false" var="sqlResult"><![CDATA[
		SELECT 	NVL(count(*),0) contador from odf_ca_cabr_int_fin_staging WHERE odf_parent_id = ${gel_objectInstanceId}
		]]></sql:query><core:forEach items="${sqlResult.rows}" trim="true" var="row"><core:set value="${row.contador}" var="STAGGING_DATA_RECORDS"/></core:forEach><core:if test="${icount != STAGGING_DATA_RECORDS}"><core:if test="${DebugLevel > 1}"><gel:log level="debug" message="QUANTIDADE DE LINHAS INCORRETA NA TABELA STAGGIN_DATA."/></core:if><!--INICIO: verifica se existem registros carregados que ainda nao foram importado, se existir notifica usiario e sai--><sql:update escapeText="false" var="sqlResult"><![CDATA[
			DELETE FROM odf_ca_cabr_int_fin_staging WHERE odf_parent_id = ${gel_objectInstanceId} 
					AND code like '${gel_processInstanceId}-%'
		]]></sql:update><gel:email from="admin-clarity@clarity.com" fromName="Clarity Admin"
                          subject="[CLARITY - PROTHEUS - IMPORTAÇÃO] - PASSO 01: ERRO NA IMPORTAÇÃO ARQUIVO PROTHEUS : ${gel_objectInstanceId}" to="${MAIL_TO_ADMIN}"><![CDATA[
					
					O arquivo não foi importado "${ORIGIN_FILE_NAME}". Verifique arquivos de log.</br>
					Caso os arquivos não tenham sido gerados re-execute o processo com o parâmetro Debug = 2.</br></br></br>
					Instância Integração: "${gel_objectInstanceId}"</br>
					Instância Processo: "${gel_processInstanceId}" </br></br>
					Arquivo XOG: "${XOG_SERIALIZED_FILE}"</br>
					Arquivo Saída XOG: "${XOG_SERIALIZED_OUTPUT_FILE}"</br>
					
					Mensagem Processamento XOG: ${XOG_STATUS_STATE}</br>
					Quantidade de Registros Arquivo de Origem: ${icount}</br>
					FAILURE_RECORDS: ${XOG_FAILURE_RECORDS} </br>
					INSERTED_RECORDS: ${XOG_INSERTED_RECORDS} </br>
					UPDATE_RECORDS: ${XOG_UPDATED_RECORDS} </br>
					TOTAL_RECORDS: ${XOG_TOTAL_RECORDS} </br>
					ERR_REF_NUM: ${XOG_REF_NUMBER} </br>
					ERR_INFO: ${XOG_ERR_INFORMATION}</br>
					]]></gel:email></core:if><!--FIM: VERIFICACAO DE QUANTIDADE DE REGISTROS--><!--IF RECORD EXISTS--></core:if></core:if><!--END FILE PROCESSING--></gel:script></scriptText><scriptParameter isSecure="false" name="XOG_USER_NAME" value="xog_user"/><scriptParameter isSecure="true" name="XOG_PASSWORD" value="[DES]xPAibXEGYtzFewI3ulWtRg=="/><scriptParameter isSecure="false" name="INCLUDE_FOLDER" value="/fs0/clarity1/share/includes/"/><scriptParameter isSecure="false" name="ORIGIN_FOLDER" value="/fs0/clarity1/share/entrada/"/><scriptParameter isSecure="false" name="TARGET_FOLDER" value="/fs0/clarity1/share/entrada/processado/"/><scriptParameter isSecure="false" name="DebugLevel" value="2"/></customScript><Notifications notifyOwner="false"><NotifyWhen stepActionInError="false" stepActionPerformed="false"/><Assignees/></Notifications></Action></Operations><TransitionRestrictions><TransitionRestriction><Join type="BPM_JT_NONE"><Condition sequencNo="1" type="BPM_SCT_PRECONDITION"/></Join></TransitionRestriction><TransitionRestriction><Split type="BPM_ST_SEQUENCE"><Condition sequencNo="1" type="BPM_SCT_POSTCONDITION"><Transitions><Transition to="Término"/></Transitions></Condition></Split></TransitionRestriction></TransitionRestrictions></Step></Steps><Groups/><OBSAssocs complete="false"/></Process></Processes><lookups update="true"><staticLookup autoSuggestEnabled="true" autoSuggestMaxSuggestions="10" code="CAL_EVENT_PRIORITY" hiddenAttributeName="id" sortStyle="manual"
    source="niku.com" status="active" update="true"><nls description="Priorita události kalendáře" languageCode="cs" name="Priorita kalendáře"/><nls description="Prioritet for kalenderaftale" languageCode="da" name="Kalenderprioritet"/><nls description="Kalenderereignis - Priorität" languageCode="de" name="Kalenderpriorität"/><nls description="Calendar Event Priority" languageCode="en" name="Calendar Priority"/><nls description="Prioridad de los eventos del calendario" languageCode="es" name="Prioridad del calendario"/><nls description="Kalenteritapahtuman prioriteetti" languageCode="fi" name="Kalenteriprioriteetti"/><nls description="Priorité des événements du calendrier" languageCode="fr" name="Priorité sur le calendrier"/><nls description="Naptáresemény prioritása" languageCode="hu" name="Naptár prioritása"/><nls description="Priorità eventi calendario" languageCode="it" name="Priorità calendario"/><nls description="カレンダ イベントの優先度" languageCode="ja" name="カレンダの優先度"/><nls description="일정 이벤트 우선 순위" languageCode="ko" name="일정 우선 순위"/><nls description="Prioriteit agenda-evenement" languageCode="nl" name="Agenda prioriteit"/><nls description="Kalenderbegivenhetsprioritet" languageCode="no" name="Kalenderprioritet"/><nls description="Priorytet zdarzenia w kalendarzu" languageCode="pl" name="Priorytet kalendarza"/><nls description="Prioridade do evento do calendário" languageCode="pt" name="Prioridade do calendário"/><nls description="Приоритет события календаря" languageCode="ru" name="Приоритет календаря"/><nls description="Prioritet för kalenderhändelse" languageCode="sv" name="Kalenderprioritet"/><nls description="Takvim Olayı Önceliği" languageCode="tr" name="Takvim Önceliği"/><nls description="日历事件优先级" languageCode="zh" name="日历优先级"/><nls description="行事曆事件優先順序" languageCode="zh_TW" name="行事曆優先順序"/><lookupValue code="CAL_LOW" sortOrder="1" status="active"><nls description="Nízké" languageCode="cs" name="Nízké"/><nls description="Lav" languageCode="da" name="Lav"/><nls description="Niedrig" languageCode="de" name="Niedrig"/><nls description="Low" languageCode="en" name="Low"/><nls description="Bajo" languageCode="es" name="Bajo"/><nls description="Matala" languageCode="fi" name="Matala"/><nls description="Faible" languageCode="fr" name="Faible"/><nls description="Alacsony" languageCode="hu" name="Alacsony"/><nls description="Bassa" languageCode="it" name="Bassa"/><nls description="低" languageCode="ja" name="低"/><nls description="낮음" languageCode="ko" name="낮음"/><nls description="Laag" languageCode="nl" name="Laag"/><nls description="Lav" languageCode="no" name="Lav"/><nls description="Niski" languageCode="pl" name="Niski"/><nls description="Baixo" languageCode="pt" name="Baixo"/><nls description="Низкий" languageCode="ru" name="Низкий"/><nls description="Låg" languageCode="sv" name="Låg"/><nls description="Düşük" languageCode="tr" name="Düşük"/><nls description="低" languageCode="zh" name="低"/><nls description="低" languageCode="zh_TW" name="低"/></lookupValue><lookupValue code="CAL_MEDIUM" sortOrder="2" status="active"><nls description="Střední" languageCode="cs" name="Střední"/><nls description="Mellem" languageCode="da" name="Mellem"/><nls description="Mittel" languageCode="de" name="Mittel"/><nls description="Medium" languageCode="en" name="Medium"/><nls description="Medio" languageCode="es" name="Medio"/><nls description="Keskisuuri" languageCode="fi" name="Keskisuuri"/><nls description="Moyen(ne)" languageCode="fr" name="Moyen(ne)"/><nls description="Közepes" languageCode="hu" name="Közepes"/><nls description="Media" languageCode="it" name="Media"/><nls description="中" languageCode="ja" name="中"/><nls description="중간" languageCode="ko" name="중간"/><nls description="Gemiddeld" languageCode="nl" name="Gemiddeld"/><nls description="Middels" languageCode="no" name="Middels"/><nls description="Średni" languageCode="pl" name="Średni"/><nls description="Médio" languageCode="pt" name="Médio"/><nls description="Средний" languageCode="ru" name="Средний"/><nls description="Medel" languageCode="sv" name="Medel"/><nls description="Orta" languageCode="tr" name="Orta"/><nls description="中" languageCode="zh" name="中"/><nls description="中" languageCode="zh_TW" name="中"/></lookupValue><lookupValue code="CAL_HIGH" sortOrder="3" status="active"><nls description="Vysoké" languageCode="cs" name="Vysoké"/><nls description="Høj" languageCode="da" name="Høj"/><nls description="Hoch" languageCode="de" name="Hoch"/><nls description="High" languageCode="en" name="High"/><nls description="Alto" languageCode="es" name="Alto"/><nls description="Korkea" languageCode="fi" name="Korkea"/><nls description="Elevé(e)" languageCode="fr" name="Elevé(e)"/><nls description="Magas" languageCode="hu" name="Magas"/><nls description="Alta" languageCode="it" name="Alta"/><nls description="高" languageCode="ja" name="高"/><nls description="높음" languageCode="ko" name="높음"/><nls description="Hoog" languageCode="nl" name="Hoog"/><nls description="Høy" languageCode="no" name="Høy"/><nls description="Wysoki" languageCode="pl" name="Wysoki"/><nls description="Alto" languageCode="pt" name="Alto"/><nls description="Высокий" languageCode="ru" name="Высокий"/><nls description="Hög" languageCode="sv" name="Hög"/><nls description="Yüksek" languageCode="tr" name="Yüksek"/><nls description="高" languageCode="zh" name="高"/><nls description="高" languageCode="zh_TW" name="高"/></lookupValue><displayedSuggestionAttributes><displayedSuggestionAttribute value="name"/></displayedSuggestionAttributes><searchedSuggestionAttributes><searchedSuggestionAttribute value="name"/></searchedSuggestionAttributes></staticLookup></lookups></contentPack><XOGOutput> <Object type="contentPack"/> <Status state="SUCCESS"/> <Statistics insertedRecords="0" failureRecords="0" totalNumberOfRecords="2" updatedRecords="0"/> <Records/> </XOGOutput></NikuDataBus>